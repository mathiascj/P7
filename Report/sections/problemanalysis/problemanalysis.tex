\chapter{Problem Analysis}\label{ch:problemanalysis}
In this chapter, we delwe deeper into the problem stated in \cref{ch:introduction}. While the eventual solution is aimed at the area of modular factories as a whole, we use the FESTO modular factory system \cite{FESTOweb} as a point of reference. This system was chosen specifically as Aalborg University's Department of Mechanical and Manufacturing Engineering have an existing set-up, which we were allowed to inspect. 

\section{FESTO}\label{sec:festo}
The FESTO system accessible to us is the Cyber-Physcial(CP) Learning Factory. This is not intended for full fledged production, but rather it is used in education and research. While not an industrial system, we deem that it will aid in a general understanding of the field and its related problems. The public litterature about the CP-factory is rather light. The most reliable sources come from FESTO themselves, as in the case with \cite{CPFactory2015}. To supply the written material in this section, we also use our own observations about the local set-up, in addition to statements made by staff working the factory.  

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{CP_Factory.jpg}
\caption{A CP-factory setup}
\label{fig:festo-example}
\end{figure}

An example of a CP-factory set-up can be seen in \cref{fig:festo-example}. Each module in a set-up is made up of the same base module. This includes a control panel as well as two conveyor belts moving in opposite directions. Modules can be connected either at the narrow ends or on the face opposite the control panel. On each module new equipment may be fitted. This can include a robot arm, a drill or a camera. A module works only on one item at a time. Yet several items may be located on the same module, being queued up and waiting to be worked on or pass through the module.

The factory control tasks are handled through a MES(Manufacturing Execution System)known as MES4. This controls production order dispatch, scheduling, resource management etc. During production the MES4 system signals individual modules to perform certain actions. These instructions are encoded into the module's own controller as KRL code.

The factory also uses a large amount of networking technologies. RFID technology is used to monitor the location of individual items running along the conveyor belts. Individual modules may communicate by field-bus, while overall communications in the factory occurs over a WLAN. The factory may also be connected to an Enterprise Resource Planning (ERP) system or other factories through MES4. A production run is initiated by activating each module through its control panel, then launching from a PC.

\section{Problems in modular factories}
Through our discussion with staff at Aalborg University we identified some problems relating to use of the CP Learning Factory. Additional problems concerning modular factories in general were found by looking into the literature. In this section we will examine each of these issues. 

\subsection{Calculating an optimal factory configuration}
Aalborg staff relayed to us that they would like to generate optimal factory configurations according to some order of items, which must be produced. A configuration is here the same as the layout of a factory, which considers where modules are placed, and which other modules they connect to.

Product Lifecycle Management (PLM) systems such as Siemens' Technomatix \cite{Siemens2014} have this sort of functionality included. Technomatix is able to simulate factories and their throughput before implementation. Yet, the system does not focus on rapidly changing factory configurations. It concerns itself with getting the configuration right before implementation. When new orders come in, Technomatix may suggest how to optimize production parameters for an implemented configuration. This may entail an alteration in how production is scheduled. A production schedule informs us, how we should produce an order of items using a specefic configuration. Manufacturers are interested in finding the schedule, which delivers the the highest throughput of items on a given configuration. 

As Technomatix is more about altering parameters of current factory configurations, it is not a good fit when working with modular factories. In a modular factory system, the factory configuration may be altered in response to a new order of items. The problem is not only about finding the schedule with the highest throughput on an already implemented configuration. It also concerns looking at alternative configurations, and seeing if any of these have an even better schedule. We may also have to deal with the cost of moving from one configuration to the next. Even though one configuration may be very efficient, it may be expensive to reconfigure the current configuration in order to set it up. 

\subsection{Manual Software Reconfiguration}
On the issue of reconfiguration, Aalborg staff informed us that the difficult part of setting up a new factory configuration is not the moving and connecting of the physical modules. Instead it is the alterations made to individual modules. As mentioned in \cref{sec:festo}, each module has a set of instructions encoded in KRL code, which the MES4 system may signal for them to accomplish. As a factory is reconfigured this code will most likely have to be changed. This is no light task, as there must be an instruction for each case in which MES4 system may signal the module. If a red phone has to be treated differently from a black phone, there needs to be a separate instruction. Programmers have to handle each mundane case, leading to a lot of boilerplate code. 

The staff here at Aalborg themselves, suggested that they would like a way to generate the KRL code. This problem is of course not only relevant in the case of FESTO. Any production line has to update its machine controlling code, if it reconfigures its layout.

\subsection{Security}
Like with the rest of Industry 4.0, modular factories rely heavily on networking technologies to interconnect every part of production. Through this network a lot of security and safety-critical data is send. According to Sadeghi\cite{Sadeghi2015}, security is often not adequate and modular factories are thus at risk of infiltration from many different angles. This is an issue, as an attack on a modular factory risks both a monetary, but also a human loss. Yet, it also seems that many modern security methods do not work for the modular factory. This is in part because a factory has a high requirement for availability. Thus a registered attack can not simply be countered by halting production. In addition, modules are often required to have low power consumption and minimal cost. Again, security features will clash with these requirements. 

\subsection{Big Data}
Modular factories store a lot of data about their production. Each individual module, item and piece of equipment may be a source of information. Thus there is a vast amount of heterogeneous data to deal with. We must concern the field of Big Data, the challenges it brings along. Yin \cite{Yin2015} mentions that the size of data itself puts significant requirements on both hardware and software. He also states that there is an issue of how to use the data for real time analysis and detection. Not all data is interesting either, so the cleaning of raw data has to be handled as well. 

\section{A running factory example}\label{sec:runningexample}
In this section we set up an example of a factory, which we will refer to throughout the report. It can be seen on \cref{fig:running-example}. It depicts a specific factory configuration for producing children's toys. A configuration will from here on refer to the physical layout of modules, and how they connect to each other. We use this example to present some of the core concepts used in this report. This is also the first step towards modeling a factory. Therefore we also get into, how we choose to abstract away from parts of the real world. 

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{runningexample.pdf}
\caption{An example of a toy factory layout}
\label{fig:running-example}
\end{figure}

\subsection{Modules}
On the diagram, we have chosen to depict a module as a square, which may connect to other modules. Each module has a name, shown in bold. A module may perform one or more types of work upon an item, these are shown in parenthesis. Each work type takes a certain amount of time to complete. It also takes a certain amount of time for an item to be transported through a module. A module may only work on one item at a time. These are all properties, which we discovered by inspecting the CP learning factory.

A connection signifies, how we may pass items between modules. There are real world physical restrictions upon these connections, in that each module may only connect to at most four other modules. At the same time, a module can only connect to another module, if they are placed right next to each other. On the diagram, we have chosen to move the modules away from each other to fit the arrows, but in the physical layout connected modules lay side by side. Yet, just because modules are placed next to each other, does not mean there needs to be a connection.

We choose to restrict connections in this way as modules tend to be rectangular in shape as in the case of the CP learning factory. We also allow only one neighbour per side, restricting us to four connections total. In reality the modules in the CP learning factory leave one side open for a control panel, so only three neighbours are allowed. We choose to look away from this requirement, as this may not be the case for all real life modules. We choose to view our modules as square, while the CP learning factory modules are only rectangular. Modules from different systems may have many different shapes, so we choose the one, which is easiest to work with, when we later have to deal with modelling the physical placement of modules. If we need to model non-square modules, we must add their properties to the rule set, which guides placement. 

If we wish to connect two modules, which are not neighbours, we may connect them through one or more transport modules. This is a type of module that does not perform any type of work on items, other than ferrying them along a conveyor. On the diagram, a transporter is used to connect the \textit{Painter} and \textit{Wrapper} modules. Yet, using transport modules we can not freely connect any two modules, as the transporters have to be physically placeable. That is, they may physically not intersect any other module. This is the case when placing down any type of module. We view the factory layout on a 2-dimensional plane, where each module has the same height. This means that two modules intersect, if they take up the same space on this plane. We choose to disregard the third dimension, as modules tend to be of equal height. 

\subsection{Items}
In our factory, several items may be produced. Let us say that we need to produce a doll, whose base needs to be loaded onto the factory first. This is followed by attachment of arms, legs and head. Finally the doll is painted and gift wrapped. In our case, this could be accomplished by loading the doll onto the factory using the \textit{Doll loader}. It should then pass through the \textit{Limb giver}, \textit{Head machine}, \textit{Painter} and finally \textit{Gift wrapper}. At the \textit{Gift wrapper} module the doll may finally be removed from the factory.

An item can be described by a start module, as well as a sequence of actions that needs to be performed on it. All identical items are as such created according to the same recipe, containing the steps needed to produce that item. 

\subsection{Parallelism}
We also introduce the idea of parallel manufacture in the diagram. This comes in two varieties. Aalborg staff have not set up their factory to enable parallel production, but they stated that it was a possibility they might use, if they needed to increases throughput.

In the bottom line we have \textit{Jigsaw} and \textit{Buzzsaw} modules performing the \textit{saw} work type. Let us say that we need to produce many baseball bats. If we only had the \textit{Jigsaw} module, each plank of wood coming from the \textit{Wood loader} would have to queue up and wait while the \textit{Jigsaw} module worked on the first plank to enter it. By adding the \textit{Buzzsaw} we allow for a plank to move through the \textit{Jigsaw} module to get sawed by \textit{Buzzsaw}. Thus the additional module increases throughput, by allowing the same type of work to be performed at two places in the factory. 

Another type of parallelism can be seen in the upper branch of the factory diagram. Here the additional modules, which put arms and legs on the doll, are branched out from the main line and then reconnected to the \textit{Head machine} so that dolls worked on by this branch may also receive a head. This type of parallel execution may be preferred if we wish not to lengthen a branch. Another interesting detail about this parallelization is that the work types performed by the \textit{Limb giver} module is distributed across the parallel branch. 

\input {sections/problemanalysis/problemdefinition.tex}

